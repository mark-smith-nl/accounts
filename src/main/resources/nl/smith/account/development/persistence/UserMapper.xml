<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="nl.smith.account.development.persistence.UserMapper">

	<resultMap id="user" type="nl.smith.account.development.domain.User"
		autoMapping="true">
		<id property="userId" column="userid" />
		 <collection property="roles" ofType="string"><result column="roleName" /></collection>
	</resultMap>

	<select id="getUserByUsername" parameterType="string" resultMap="user">
		SELECT users.*, roles.name as roleName
		FROM names.users
		LEFT JOIN names.users_roles_link USING(userid)
		LEFT JOIN names.roles USING(roleid)
		WHERE username = #{value}
	</select>

</mapper>